<button
  [disabled]="disabled"
  [ngClass]="selectButtonClasses"
  (blur)="trySetTouched()"
  (keydown.arrowDown)="show()"
  (keydown.arrowUp)="show()"
  class="select-button"
  type="button"
  #selectButton
>
  <span>
    <ng-container *ngIf="selectionModel.length; else placeholderTemplate">
      <ng-container *ngIf="customLabel; else defaultSelectionTemplate">
        <ng-content select="nb-select-label"></ng-content>
      </ng-container>

      <ng-template #defaultSelectionTemplate>{{ selectionView }}</ng-template>
    </ng-container>

    <ng-template #placeholderTemplate>{{ placeholder }}</ng-template>
  </span>

  <nb-icon
    icon="chevron-down-outline"
    pack="nebular-essentials"
    (click)="disabled && $event.stopPropagation()"
    aria-hidden="true"
  >
  </nb-icon>
</button>
<!-- Original -->
<ng-container *ngIf="!isInfinite">
  <nb-option-list
    *nbPortal
    [size]="size"
    [position]="overlayPosition"
    [style.width.px]="optionsWidth"
    [ngClass]="optionsListClass"
  >
    <ng-content select="nb-option, nb-option-group"></ng-content>
  </nb-option-list>
</ng-container>

<!-- V1 -->
<!-- Cdk virtual scroll refuses to work with ng-content, so if we want to avoid passing virtual scroll viewport and options into select -->
<!-- We have to generate options anew based on contentchildren -->
<ng-container *ngIf="isInfinite">
  <nb-option-list
    *nbPortal
    [size]="size"
    [position]="overlayPosition"
    [style.width.px]="optionsWidth"
    [ngClass]="optionsListClass"
  >
    <cdk-virtual-scroll-viewport [itemSize]="itemSize">
      <ng-container *cdkVirtualFor="let optionItem of optionsToArray">
        <nb-option
          [value]="optionItem.value"
          [disabled]="optionItem.disabled"
          [templateToDisplay]="optionItem.template"
          [selected]="optionItem.selected"
          (optionClick)="handleOptionClick($event)"
        >
        </nb-option>
      </ng-container>
    </cdk-virtual-scroll-viewport>
  </nb-option-list>
</ng-container>
